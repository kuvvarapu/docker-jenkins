

image: java:8 cache:   key: merchants-api   paths:     - .m2/repository stages:  - dependencies  - build  - deploy variables:   PRODUCT_ARTIFACT: 'merchants-api.jar' resolve dependencies:   image: maven:3.5.2-slim   stage: dependencies   script:     - mvn validate -s .mvn/settings.xml -Dmaven.repo.local=.m2/repository   only:     - master test and package:  image: maven:3.5.2-slim  stage: build  script:   - mvn test -s .mvn/settings.xml -Dmaven.repo.local=.m2/repository  except:   - develop   - master test and package:  image: maven:3.5.2-slim  stage: build  variables:    VERSION_FILE: merchants/src/main/resources/public/reports/build-info.txt  script:   - rm -Rf merchants/src/main/resources/public/reports   - mkdir -p merchants/src/main/resources/public/reports/coverage   - sh .devops/ci/build-info.sh $VERSION_FILE   - mvn verify -s .mvn/settings.xml -Dmaven.repo.local=.m2/repository  only:   - develop   - master  artifacts:   paths:     - merchants/target/$PRODUCT_ARTIFACT devqa-deploy:  image: localhost:5000/hc-ci  stage: deploy  dependencies:   - test and package  only:   - develop  script:     #TODO copy artifact to image and bild     - mkdir -p target/deploy     - cp -rf merchants/target/$PRODUCT_ARTIFACT target/deploy     - sh /deploy/evaluate.sh .devops/app-devqa.conf     - cp /deploy-target/deploy.sh target/deploy.sh     - cp -rf /deploy-target/aws/* target/deploy/    #Code push    #TODO add ls to check /deploy-target     - cat target/deploy/appspec.yml     - cat target/deploy.sh     - sh target/deploy.sh preprod-deploy:  image: localhost:5000/hc-ci  stage: deploy  dependencies:   - test and package  only:   - master  script:     #TODO copy artifact to image and bild     - mkdir -p target/deploy     - cp -rf merchants/target/$PRODUCT_ARTIFACT target/deploy     - sh /deploy/evaluate.sh .devops/app-preprod.conf     - cp /deploy-target/deploy.sh target/deploy.sh     - cp -rf /deploy-target/aws/* target/deploy/    #Code push    #TODO add ls to check /deploy-target     - cat target/deploy/appspec.yml     - cat target/deploy.sh     - sh target/deploy.sh
